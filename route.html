<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps.css" />
  <script src="https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.18.0/maps/maps-web.min.js"></script>
  <style>
    #suggestions {
        position: absolute;
        background: #fff;
        border: 1px solid #ccc;
        max-height: 200px;
        overflow-y: auto;
    }
    .suggestion {
        padding: 5px;
        cursor: pointer;
    }
</style>
  <title>Route API</title>
</head>

<body>
  <input type="text" id="query" value="">
  <button>Click me</button>
  <div id="result"></div>
  <div style="width: 80vw; height:80vh;" id="map"></div>

  <script>
    let APIKEY = "ebSKGOKaTk6WTADs40LNnaFX4X7lKlqG";
    let Vancouver = [-123.1207, 49.2827];
    let map = tt.map({
      key: APIKEY,
      container: 'map',
      center: Vancouver,
      zoom: 14,
    });


    // get latitude and longitude dynamically.

    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    console.log(latitude);

    // search & get location
    let search = function () {
      tt.services.fuzzuySearch({}).go.then(handleResults)
    };

    getLocation();

    // load & add the marker on the map
    map.on("load", () => {
      new tt.Marker().setLngLat([longitude, latitude]).addTo(map);
    })

    // Getaddress customer's address from Firebase
    displayAddress();

    // Get longtitude and latitude from the address
    function getLatLngFromAddress(address) {
      // 住所情報を使ってジオコーディングサービスを呼び出し、緯度経度情報を取得する
      // 例: Google Maps Geocoding APIやTomTom Geocoding APIを利用する
    }

    // Set the destination as a center.
    function setDestination(center) {
      const map = tt.map({
        key: '<your-tomtom-maps-API-key>',
        container: 'map',
        dragPan: !isMobileOrTablet(),
        center: center,
        zoom: 14
      });
    }

    // メインの処理フロー
    getAddressFromFirebase()
      .then((address) => getLatLngFromAddress(address))
      .then((center) => setDestination(center))
      .catch((error) => console.error(error));

    // full screen & zoomin & zoom out
    map.addControl(new tt.FullscreenControl());
    map.addControl(new tt.NavigationControl());

  </script>



  <!-- <form>
    <input type="text" id="addressInput" placeholder="Enter an address">
  </form>
  <div id="suggestions"></div>
  <script>
    const addressInput = document.getElementById('addressInput');
    const suggestionsContainer = document.getElementById('suggestions');
    // Event listener for input changes
    addressInput.addEventListener('input', handleInput);

    // fazzy search
    function handleInput() {
      const inputValue = addressInput.value;
      const searchURL = `https://api.tomtom.com/search/2/search/${encodeURIComponent(inputValue)}.json?key${APIKEY}&limit=5&language=en-US`

      // console.log(searchURL);

      fetch(searchURL)
        .then(response => response.json())  //response is the object about result of fetch(URL). response.json() purlse the response result in a json.
        .then(data => { // data is one of the object which response.json() has. Inside the data object, there is the data which we want. 
          console.log(data);
          showSuggestion(data.results) // call the showSuggestion() to show the candidate address and data.result go through the fetched data.
        })
        .catch(error => {
          console.error("Error:", error);
        });
    }

    // Display autocomplete suggestions
    function showSuggestions(suggestions) { // "sugestions" is a parameter and here go through the candidate address which user input. 
      suggestionsContainer.innerHTML = '';

      suggestions.forEach(suggestion => { // go through each candidate.
        const suggestionElement = document.createElement('div');
        suggestionElement.classList.add('suggestion');
        suggestionElement.textContent = suggestion.address.freeformAddress; //show the address inside the div.

        suggestionElement.addEventListener('click', () => {
          // Handle the selected address
          const selectedAddress = suggestion.address.freeformAddress;
          console.log(selectedAddress);
        });

        suggestionsContainer.appendChild(suggestionElement);
      });
    }
  </script> -->




<form>
  <input type="text" id="addressInput" placeholder="Enter an address">
  <button id="clearAddress" type="clear">Clear Address</button>
  <button type="submit" id="startFrag">Start</button>
  <button type="submit" id="endFrag">Destination</button>


</form>

<div id="suggestions"></div>

<script>
  // Replace 'YOUR_API_KEY' with your actual TomTom API key
  const addressInput = document.getElementById('addressInput');
  const suggestionsContainer = document.getElementById('suggestions');

  // Event listener for input changes
  addressInput.addEventListener('input', handleInput);

  // Fetch autocomplete suggestions
  function handleInput() {
      const inputValue = addressInput.value;
      const autocompleteUrl = `https://api.tomtom.com/search/2/search/${encodeURIComponent(
          inputValue
      )}.json?key=${APIKEY}&limit=5&language=en-US`;
      console.log(autocompleteUrl);
      fetch(autocompleteUrl)
          .then(response => response.json())
          .then(data => {
              console.log(data);
              showSuggestions(data.results);
          })
          .catch(error => {
              console.error('Error:', error);
          });
  }

  // Display autocomplete suggestions
  function showSuggestions(suggestions) {
      suggestionsContainer.innerHTML = '';

      suggestions.forEach(suggestion => {
          const suggestionElement = document.createElement('div');
          suggestionElement.classList.add('suggestion');
          suggestionElement.textContent = suggestion.address.freeformAddress;

          suggestionElement.addEventListener('click', () => {
              // Handle the selected address
              const selectedAddress = suggestion.address.freeformAddress;
              addressInput.value = selectedAddress;
              suggestionsContainer.innerHTML = "";
              // console.log(selectedAddress);
          });

          suggestionsContainer.appendChild(suggestionElement);
      });
  }


  let clearAddress = document.getElementById("clearAddress")
  clearAddress.addEventListener("click", clearSuggestions)
  function clearSuggestions () {
    addressInput.value = "";
  }


  let startFrag = document.getElementById("startFrag");
  startFrag.addEventListener("click", addStartFrag);

  function addStartFrag () {
    let startMarker = new tt.Marker().setLngLat()
  }


  function addDestinationFrag () {

  } 


  
</script>
</body>

</html>